{'image': 'https://tryhackme-images.s3.amazonaws.com/room-icons/ae4bd465dbc01f0b09273ebbc1496063.png', 'title': 'Printer Hacking 101', 'description': 'Learn about (and get hands on with) printer hacking and understand the basics of IPP.', 'code': 'printerhacking101', 'users': 8765, 'tags': ['iot', 'security', 'cups', 'pret'], 'type': 'walkthrough', 'difficulty': 'easy', 'userCompleted': False, 'upVotes': 438, 'created': '2020-09-29T14:01:43.511Z', 'published': '2020-09-29T19:30:00.298Z', 'freeToUse': True, 'businessOnly': False, 'headerImage': 'https://assets.tryhackme.com/room-banners/printerhacking101.png', 'creator': 'Swafox', 'tasks': [{'taskTitle': 'Unit 1 - Introduction', 'taskDesc': '<div style="text-align:center"><span style="font-size:1rem">In this room, we will look at the most common printer hacking techniques and will look at why they\'re made vulnerable</span><span style="font-size:1rem">.\xa0</span><br /></div><div><br /></div><div>Mass printer hacking has been taking advantage of over the past few years. One example would be when\xa0<span style="font-size:1rem">one attacker hacked around 50,000 printers, printing out messages asking people to subscribe to PewDiePie.\xa0</span><span style="font-size:1rem">In the next task we\'ll take a look at the reasons behind the success of this attack.</span></div><div style="text-align:center"><span style="font-size:1rem"><br /></span></div><div style="text-align:center"><img src="https://i.imgur.com/XRdxAnk.png" style="width:471.558px;height:628.734px" /></div><div style="text-align:center"><br /></div><div style="text-align:center"><i>A sample print-out from the PewDiePie printer hacking incident</i></div><div style="text-align:center"><i><br /></i></div>', 'taskType': 'none', 'taskNo': 1, 'taskCreated': '2020-06-27T07:39:41.216Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '', 'questions': [{'questionNo': 1, 'question': 'Read the above', 'hint': ''}]}, {'taskTitle': 'Unit 2: IPP Port', 'taskDesc': '<div>The reason behind the printers\' vulnerability which effected those 50,000 printers, was simply an open IPP port.\xa0</div><div><br /></div><div>"<b>The Internet Printing Protocol (IPP)</b> - is a specialized Internet protocol for communication between client devices and printers. It allows clients to submit one or more print jobs to the printer or print server, and perform tasks such as querying the status of a printer, obtaining the status of print jobs, or canceling individual print jobs."</div><div><br /></div><div>When an IPP port is open to the internet, it is possible for anyone to print to the printer or even transfer malicious data through it (using it as a middleman for attacks).\xa0</div><div><br /></div><div>A recent study by <a href="https://www.variot.eu/" target="_blank">VARIoT</a> (Vulnerability and Attack Repository for IoT) showed that there are still around 80 thousand vulnerable printers opened to the world. Most of them appear to run the CUPS server (which is a simple UNIX printing system).\xa0</div><div><br /></div><div><img src="https://www.shadowserver.org/wp-content/uploads/2020/06/IPP-Worldmap-of-Exposded-Devices-7June2020.png" style="width:1045.56px" /><br /></div><div style="text-align:center"><i>Picture credit: <a target="_blank">Shadowserver</a></i></div><div><br /></div><div>An open IPP port can expose a lot of sensitive information such as printer name, location, model, firmware version, or even printer wifi SSID.</div>', 'taskType': 'none', 'taskNo': 2, 'taskCreated': '2020-06-27T07:55:55.816Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '', 'questions': [{'questionNo': 1, 'question': 'What port does IPP run on?<br />', 'hint': 'Use Google'}]}, {'taskTitle': 'Unit 3: Targeting & Exploitation', 'taskDesc': '<div><span style="font-size:1rem;white-space:pre">\t\t\t\t</span><span style="font-size:18px">Locating and Exploiting <b>local</b> network printers\xa0</span></div><div><br /></div><div><span style="font-size:16px">Github: </span><a href="https://github.com/RUB-NDS/PRET" target="_blank">https://github.com/RUB-NDS/PRET</a><span style="font-size:16px">\xa0&lt;- We\'ll be using this awesome toolkit throughout this next bit!\xa0</span></div><div><span style="font-size:16px"><br /></span><span style="font-size:1rem">The Printer Exploitation Toolkit is a handy tool that is used for both local targeting and exploitation.</span></div><div><br /></div><div>You can install it by running the following commands:</div><div><code>git clone https://github.com/RUB-NDS/PRET &amp;&amp; cd PRET<br />python2 -m pip install colorama pysnmP</code></div><div><br /></div><div><span style="background-color:rgb(206, 198, 206)">- Locating printers</span></div><div><br /></div><div>Simply running <code>python pret.py</code> will start an automatic printer discovery in your local network.\xa0</div><div>It is also possible by running an Nmap scan on your whole network, but unfortunately, it might take a longer time. This is because the pret.py scan is focused on the ports which printer communication on by default, thus making it immensely faster.\xa0</div><div><br /></div><div style="text-align:center"><img src="https://i.imgur.com/Zmhs3MW.png " style="width:835.972px" /></div><div style="text-align:center"><br /></div><div style="text-align:center"><i>Sample output from pret.py discovering accessible printers</i></div><div><br /></div><div><br /></div><div><span style="background-color:rgb(206, 198, 206)">- Exploiting</span></div><div><br /></div><div>Now, it is time to finally exploit the printer.\xa0</div><div>There are exactly three options you need to try when exploiting a printer using PRET:</div><div>1. ps (Postscript)</div><div>2. pjl (Printer Job Language)</div><div>3. pcl (Printer Command Language)</div><div><br /></div><div>You need to try out all three languages just to see which one is going to be understood by the printer.\xa0</div><div><br /></div><div>Sample Usage:</div><div><br /></div><div><code>python pret.py {IP} pjl<br />python pret.py laserjet.lan ps<br />python pret.py /dev/usb/lp0 pcl\xa0</code></div><div>(Last option works if you have a printer connected to your computer already)</div><div><br /></div><div>After running this command, you are supposed to get shell-alike output with different commands. Run <code>help</code> to see them.</div><div><br /></div><div style="text-align:center"><img src="https://i.imgur.com/rTUSV6z.png" style="width:838.993px" /></div><div style="text-align:center"><br /></div><div style="text-align:center"><i>Various sample commands available in the different languages which printers can use to communicate</i></div><div style="text-align:center"><i><br /></i></div><div><br /></div><div>As you can see, PRET allows us to interact with the printer as if we were working with a remote directory. We can now store, delete, or add information on the printer.\xa0</div><div>(For more commands and examples read the project\'s GitHub)</div><div><br /></div><div>You can possibly try PRET on your printer at home, just to test its security.\xa0</div><div>Here\'s a nice cheat sheet:\xa0<a href="http://hacking-printers.net/wiki/index.php/Printer_Security_Testing_Cheat_Sheet">hacking-printers.net/wiki/index.php/Printer_Security_Testing_Cheat_Sheet</a></div><div><br /></div><div><br /></div><div align="center"><span style="font-size:18px">Practice - Bad Example of IPP configuration</span><br /></div><div>I have attached a <i>poorly</i> configured CUPS server VM in this task. </div><div>Deploy it and access the IPP port at\xa0<code>MACHINE_IP:631</code>. See if you can retrieve any sensitive information. <br />(PRET isn\'t going to work here as it is using port 9000 by default)<span style="font-size:1rem"></span></div><div><span style="font-size:1rem"><br /></span></div><div><b>Note also:</b> An ssh access to the machine allows you to set up ssh tunneling, opening all CUPS features and providing you an ability to use attached printers. SSH password can be easily brute-forced (weak password).<br /></div><div>An example command for ssh tunneling:</div><div><pre style="margin-bottom:1em;padding:12px 8px;border:0px;font-variant-numeric:inherit;font-variant-east-asian:inherit;font-stretch:inherit;line-height:inherit;font-family:Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif;font-size:13px;vertical-align:baseline;box-sizing:inherit;width:auto;max-height:600px;background-color:var(--black-050);border-radius:3px;overflow-wrap:normal;color:rgb(36, 39, 41)"><code>ssh printer@MACHINE_IP -T -L 3631:localhost:631</code></pre></div><div>After doing so, you can easily add the CUPS server in your VM\'s printer settings and even try to send some printing jobs.</div><div>Try out different techniques and have fun!<br /></div>', 'taskType': 'vm', 'taskNo': 3, 'taskCreated': '2020-06-27T10:23:29.558Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '5efa2c40ba720830caf35255', 'questions': [{'questionNo': 1, 'question': 'How would a simple printer TCP DoS attack look as a one-line command?', 'hint': 'Check the attached cheat sheet'}, {'questionNo': 2, 'question': '<p>Review the cheat sheet provided in the task reading above. What attack are printers often vulnerable to which involves sending more and more information until a pre-allocated buffer size is surpassed?</p>', 'hint': ''}, {'questionNo': 3, 'question': "<p>Connect to the printer per the instructions above. Where's the Fox_Printer located?<br /></p>", 'hint': ''}, {'questionNo': 4, 'question': '<p>What is the size of a test sheet?</p>', 'hint': "Send a test sheet job to the printer and see the size in the 'jobs' tab"}]}, {'taskTitle': 'Unit 4 - Conclusion', 'taskDesc': '<p>Turns out printer hacking isn\'t that hard at all.\xa0<span style="font-size:1rem">The problem here arises from low awareness of these issues and multiple misconfigurations made by administrators and users.\xa0</span></p><p><span style="font-size:1rem"><br /></span></p><p style="text-align:center"><img src="https://i.imgur.com/lcHc3zF.jpg" style="width:50%" /><span style="font-size:1rem"><br /></span></p><p><span style="font-size:1rem"><br /></span></p><p><span style="font-size:1rem">A small research project of mine suggested that it is possible to get almost full server file access by simply exploiting the printer service running on it. A shock from this discovery motivated me to create this room and bring more attention to this.</span></p><p>Now, make sure you secure your printer by making it invisible for the outer internet and re-configuring administrator access.\xa0</p>', 'taskType': 'none', 'taskNo': 4, 'taskCreated': '2020-06-27T20:45:36.967Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '', 'questions': [{'questionNo': 1, 'question': "Check that your printer isn't vulnerable, why not nmap scan it to see?", 'hint': ''}, {'questionNo': 2, 'question': 'Go learn more about printers through further research and experimentation. Congrats on completing this room!', 'hint': ''}]}]}