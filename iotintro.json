{'image': 'https://tryhackme-images.s3.amazonaws.com/room-icons/3d15e71546f98eecf07a526139b4fa90.jpeg', 'title': 'Intro to IoT Pentesting', 'description': 'A beginner friendly walkthrough for internet of things (IoT) pentesting.', 'code': 'iotintro', 'users': 7509, 'tags': ['internet of things', 'iot', 'netgear', 'ap', 'command execution'], 'type': 'walkthrough', 'difficulty': 'easy', 'userCompleted': False, 'upVotes': 362, 'created': '2020-08-05T14:06:36.168Z', 'published': '2020-08-05T19:00:00.049Z', 'freeToUse': True, 'businessOnly': False, 'headerImage': 'https://i.imgur.com/b475ppm.png', 'creator': 'MrSeth6797', 'tasks': [{'taskTitle': 'Foreword', 'taskDesc': '<p align="center">Hey everyone,</p><p align="center">I\'ve been lately intrigued by IoT security so I started looking into it.</p><p align="center">I might also release other rooms later related to this subject.<br /></p><p align="center">Deploy the machine. It shouldn\'t take more than 2-3 minutes to fully boot.</p>', 'taskType': 'vm', 'taskNo': 1, 'taskCreated': '2020-06-16T14:09:31.179Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '5ee8c8e6410d9754bb6435e0', 'questions': [{'questionNo': 1, 'question': 'Deploy the machine<br />', 'hint': ''}]}, {'taskTitle': 'A little theory', 'taskDesc': '<p align="center" style="text-align:left"><b><span style="font-size:18px">What is firmware?</span></b></p><p>A firmware is a small piece of software that makes hardware work and do what its manufacturer intended it to do. Without it the devices we use wouldn\'t work.</p><p align="center" style="text-align:left"><b><span style="font-size:18px">How to obtain it?</span></b></p><p>These are the main ways of obtaining the firmware:</p><ol><li style="font-family:&quot;Helvetica Neue&quot;, &quot;Helvetica&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:1.5;margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;list-style-type:decimal"><span style="font-family:&quot;Ubuntu Mono&quot;;font-size:16px">Obtaining it from the vendor\'s website</span></li><li style="font-family:&quot;Helvetica Neue&quot;, &quot;Helvetica&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:1.5;margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;list-style-type:decimal"><span style="font-family:&quot;Ubuntu Mono&quot;;font-size:16px">Googling it<br /></span></li><li style="font-family:&quot;Helvetica Neue&quot;, &quot;Helvetica&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:1.5;margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;list-style-type:decimal"><span style="font-family:&quot;Ubuntu Mono&quot;;font-size:16px">Reversing the mobile application \xa0</span></li><li style="font-family:&quot;Helvetica Neue&quot;, &quot;Helvetica&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:1.5;margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;list-style-type:decimal"><span style="font-family:&quot;Ubuntu Mono&quot;;font-size:16px">Sniffing the OTA (over the air) update mechanism</span></li><li style="font-family:&quot;Helvetica Neue&quot;, &quot;Helvetica&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:1.5;margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;list-style-type:decimal"><span style="font-family:&quot;Ubuntu Mono&quot;;font-size:16px">Dumping it from the device</span></li></ol><p style="text-align:left;font-family:&quot;Helvetica Neue&quot;, Helvetica, Helvetica, Arial, sans-serif;font-size:14px;line-height:1.5;margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;list-style-type:decimal" align="center"><span style="font-family:&quot;Ubuntu Mono&quot;;font-size:18px"><b>Where was this firmware used?</b></span></p><p style="font-family:&quot;Helvetica Neue&quot;, &quot;Helvetica&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:1.5;margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;list-style-type:decimal" align="left"><span style="font-family:&quot;Ubuntu Mono&quot;;font-size:16px">The firmware we are about to analyze was used by Netgear for a few of their AP (access point) products.<b> </b>Besides that, the vulnerability affected multiple firmwares. You can take a look at them here: <a href="https://www.cvedetails.com/cve/CVE-2016-1555/" target="_blank">CVE-2016-1555</a>.<br /><b></b></span></p>', 'taskType': 'none', 'taskNo': 2, 'taskCreated': '2020-06-16T14:20:31.580Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '', 'questions': [{'questionNo': 1, 'question': 'Read the above<br />', 'hint': ''}]}, {'taskTitle': 'Connecting to the machine', 'taskDesc': '<p align="center">Once the machine is deployed, connect to it using SSH.</p><p align="center">The credentials are as follows</p><p align="center">Username:\xa0<b>iot</b><br /><b>Password: tryhackme123</b>!<br />Machine IP: MACHINE_IP</p>', 'taskType': 'none', 'taskNo': 3, 'taskCreated': '2020-06-16T14:18:07.583Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '', 'questions': [{'questionNo': 1, 'question': '<b>Connect to the machine via SSH<br /></b>', 'hint': ''}]}, {'taskTitle': 'Unpacking the firmware', 'taskDesc': '<p>The firmware we are going to use is from NetGear and was used for Access Points (now it\'s been superceded by another version). In case you want to download it locally on your machine this is the download link: <a href="http://www.downloads.netgear.com/files/GDC/WNAP320/WNAP320%20Firmware%20Version%202.0.3.zip">http://www.downloads.netgear.com/files/GDC/WNAP320/WNAP320%20Firmware%20Version%202.0.3.zip</a> <br /></p><p>If you access the Desktop folder, you should see the firmware zip archive.</p><p>Let\'s unzip the archive.</p><p align="center"><img style="width:435px" src="https://imgur.com/JrWBJ4Y.png" /></p><p align="left">As you can see, it dropped the release notes and another TAR archive. Let\'s extract that one too.</p><p align="center"><img style="width:823px" src="https://imgur.com/4yJfCCB.png" /></p><p align="left">The file that interests us the most is "<b>rootfs.squashfs</b>".</p><p align="left">Let\'s use binwalk to extract the filesystem as follows:</p><p align="center"><img style="width:1046px" src="https://imgur.com/dVTGGvM.png" /><br /></p><p align="left"> As you can see, it dropped another folder named "<b>_rootfs.squashfs.extracted</b>".</p><p align="left">Take a look inside the folder. </p><p align="left">What it looks like?</p><p align="left">It looks like linux filesystems. </p><p align="left">If you go into /home/www you\'ll find the web application that is used.</p><p align="center"><img style="width:1046px" src="https://imgur.com/hVsyVsd.png" /></p>', 'taskType': 'none', 'taskNo': 4, 'taskCreated': '2020-06-16T14:29:58.834Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '', 'questions': [{'questionNo': 1, 'question': 'Read the above.', 'hint': ''}]}, {'taskTitle': 'Attacking the application', 'taskDesc': '<p>The next step would be analyzing each php file to try to find a vulnerability.\xa0<span style="font-size:1rem">I\'ll save you that time, and we\'ll take a look at "</span><b style="font-size:1rem">boardDataWW.php</b><span style="font-size:1rem">". This file contains a Command Execution vulnerability. The piece of code that we are interested is this:</span></p><p><img style="width:1046px" src="https://imgur.com/lgtosNW.png" /></p><p>The vulnerable function is the <b>exec()</b> one. The exec() function executes an external program without displaying the information (basically it\'s a blind command execution).</p><p>Time to emulate the system. For this task we\'ll use FAT(firmware analysis toolkit). FAT is based on <a href="https://github.com/firmadyne/firmadyne" target="_blank">Firmadyne</a> (FIRMADYNE is an automated and scalable system for performing emulation and\ndynamic analysis of Linux-based embedded firmware) with \nsome changes. Firmadyne uses a PostgreSQL database to store information \nabout the emulated images. However for the core functionality PostgreSQL is not really needed. Hence FAT doesn\'t \nuse it.<br /></p><p>Elevate your shell and copy rootfs.squashfs to firmware-analysis-toolkit folder and change the owner of the file to root.</p><p align="center"><img style="width:958px" src="https://imgur.com/YHOumDI.png" /></p><p>Now, let\'s kick off fat (firmware analysis toolkit) and emulate the system.</p><p align="center"><img style="width:554px" src="https://imgur.com/Gb9YXJz.png" /></p><p align="left"><span style="font-size:1rem">Take note to the IP that is outputted (usually is 192.168.0.100) and press enter to continue the emulation.</span><br /></p><p align="left">Once the emulation is done, create a port forward on your machine (the attacker machine) using SSH as follows:</p><p align="center"><img style="width:519px" src="https://imgur.com/zi0JCEz.png" /><br /></p><p align="center"></p><p align="left">Now, if you access <a href="http://localhost:8081">http://localhost:8081</a> you should be able to access the web application (it\'s a NetGear AP).</p><p align="left">The default credentials are\xa0<a><b>admin (as the username) and password (as the password)</b>.</a></p><p align="left">Once logged in, change the url to <a href="http://localhost:8081/boardDataWW.php" target="_blank">http://localhost:8081/boardDataWW.php</a>. In the MAC Address field add some junk data, for example I added 112233445566, submit it, intercept it using BurpSuite and forward it to the Repeater.</p><p align="left">For the PoC I pinged the localhost:</p><p align="center"><img style="width:631px" src="https://imgur.com/5QCviuy.png" /></p><p align="left">You\'ll notice a delay, which means the application is vulnerable to Command Execution.\xa0<span style="font-size:1rem">Let\'s copy the passwd file:</span></p><p align="center"><img style="width:628px" src="https://imgur.com/VOghCt5.png" /></p><p align="left">Let\'s request the file:</p><p align="center"><img style="width:438px" src="https://imgur.com/KCjxGRq.png" /></p><p align="left">Congrats, you have successfully attacked your first IoT system.<br /></p>', 'taskType': 'none', 'taskNo': 5, 'taskCreated': '2020-06-16T16:17:35.321Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '', 'questions': [{'questionNo': 1, 'question': 'Follow the steps above with the deployed machine!', 'hint': ''}]}, {'taskTitle': 'Personal thoughts', 'taskDesc': '<p>I hope you enjoyed this walkthrough.</p><p>I came to the conclusion that pentesting IoT systems/devices is not that difficult. It\'s mainly attacking a web application to gain an initial foothold to the device, or in some cases the network protocols they are using (UPnP for example). Some IoT devices might use some outdated network protocols that have publicly available exploits. Another option would be "attacking" the hardware (hardware hacking), but that involves other things like having a physical device\xa0 you can tear apart, etc.<br /></p><p>I hope you learned something new and managed to attach the machine used in this room.<br /></p>', 'taskType': 'none', 'taskNo': 6, 'taskCreated': '2020-06-16T19:57:55.969Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '', 'questions': [{'questionNo': 1, 'question': 'Read the above.', 'hint': ''}]}]}